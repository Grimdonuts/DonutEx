cmake_minimum_required(VERSION 3.10)
project(DonutEx-Windows)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} -Os")
set(CMAKE_EXE_LINKER_FLAGS_RELEASE "${CMAKE_EXE_LINKER_FLAGS_RELEASE} -s")
add_definitions(-D_WIN32)

set(MAIN_SOURCES
    main.cpp
    TextEditor.cpp
    LuaBindings.cpp
    PieceTable.cpp
)

include_directories(
    /usr/local/x86_64-w64-mingw32/include
    /usr/local/x86_64-w64-mingw32/include/imgui
    /usr/local/x86_64-w64-mingw32/include/imgui/backends
    /usr/local/x86_64-w64-mingw32/include/gl3w
    lua
    nanosvg/src
)


find_library(GLFW3 glfw3 PATHS /usr/local/x86_64-w64-mingw32/lib)
find_library(IMGUI imgui PATHS /usr/local/x86_64-w64-mingw32/lib)
find_library(GL3W gl3w PATHS /usr/local/x86_64-w64-mingw32/lib)
find_library(NFD nfd PATHS /usr/local/x86_64-w64-mingw32/lib)

add_executable(DonutEx WIN32
    ${MAIN_SOURCES}
)

target_link_libraries(DonutEx
    ${GLFW3}
    ${IMGUI}
    ${GL3W}
    ${NFD}
    ${CMAKE_SOURCE_DIR}/lua/liblua.a
    -static
    opengl32 gdi32 user32 comdlg32
)

install(TARGETS DonutEx
    RUNTIME DESTINATION bin
)

install(DIRECTORY plugins/
    DESTINATION plugins
    FILES_MATCHING PATTERN "*.lua"
)

install(DIRECTORY icons/
    DESTINATION icons
    FILES_MATCHING PATTERN "*.svg"
)